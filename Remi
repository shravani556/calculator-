
Got it ğŸ‘
This one is Defender for Cloud â€“ SQL vulnerability assessment.
Below is a clear, precise, audit-ready explanation with Portal steps + Terraform + Microsoft Learn links, same format as the others.
ğŸ” Recommendation
â€œSQL databases should have vulnerability findings resolvedâ€
1ï¸âƒ£ What Defender for Cloud is checking (Very Important)
This recommendation appears when ANY of the following is true:
âŒ SQL Vulnerability Assessment (VA) is not enabled
âŒ VA scan ran but findings exist
âŒ Findings are not remediated or not baselined
âŒ Scan has never been run
Defender expects:
âœ… Vulnerability Assessment enabled
âœ… Scan completed
âœ… Findings either Fixed or Baselined
2ï¸âƒ£ Portal â€“ Exact Remediation Steps
ğŸ”¹ Step 1: Enable SQL Vulnerability Assessment
Azure Portal â†’ SQL Server or SQL Database
Go to Microsoft Defender for Cloud
Click Vulnerability assessment
Enable Express configuration (recommended)
Automatically stores results
No Storage Account needed
Save
ğŸ“˜ Microsoft Learn
https://learn.microsoft.com/azure/defender-for-cloud/sql-azure-vulnerability-assessment
ğŸ”¹ Step 2: Run Vulnerability Scan
Open Vulnerability assessment
Click Scan
Wait for scan to complete
Review Failed / Passed / Baseline findings
ğŸ“˜
https://learn.microsoft.com/azure/azure-sql/database/sql-vulnerability-assessment
ğŸ”¹ Step 3: Fix or Baseline Findings
For each Failed finding:
Option A â€“ Fix (Preferred)
Click finding
Follow remediation guidance
Example:
Enable auditing
Encrypt connections
Remove excessive permissions
Option B â€“ Baseline (If acceptable)
If risk is accepted
Click Add baseline
Justify why itâ€™s acceptable
ğŸ“˜
https://learn.microsoft.com/azure/defender-for-cloud/sql-azure-vulnerability-assessment#baseline-results
ğŸ”¹ Step 4: Re-scan & Confirm
Click Scan
Ensure:
No unhandled failed findings
Defender status updates to Healthy (within 24 hrs)
3ï¸âƒ£ Terraform â€“ Enable Vulnerability Assessment
ğŸ”¹ Enable Defender for SQL
Copy code
Hcl
resource "azurerm_mssql_server_security_alert_policy" "sql_defender" {
  resource_group_name = azurerm_resource_group.rg.name
  server_name         = azurerm_mssql_server.sql.name
  state               = "Enabled"
}
ğŸ”¹ Enable Vulnerability Assessment (Classic / Storage-based)
Copy code
Hcl
resource "azurerm_mssql_server_vulnerability_assessment" "va" {
  server_security_alert_policy_id = azurerm_mssql_server_security_alert_policy.sql_defender.id
  storage_container_path          = azurerm_storage_account.sa.primary_blob_endpoint
  storage_account_access_key      = azurerm_storage_account.sa.primary_access_key
}
ğŸ“˜ Terraform Docs
https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/mssql_server_vulnerability_assessment
âš  Note: Express configuration cannot be fully managed via Terraform yet.
Portal enablement is acceptable and audit-approved.
4ï¸âƒ£ When Defender Marks It as â€œHealthyâ€
Defender shows Resolved when:
âœ” Vulnerability Assessment enabled
âœ” Latest scan completed
âœ” All findings fixed or baselined
â± Re-evaluation: Up to 24 hours
ğŸ“˜
https://learn.microsoft.com/azure/defender-for-cloud/recommendations-reference
5ï¸âƒ£ What to Write in Excel / Audit Evidence
Remediation Text (Copy-Paste Ready)
SQL Vulnerability Assessment was enabled using Microsoft Defender for Cloud. All identified findings were reviewed and either remediated or baselined. A re-scan was completed and the recommendation status is Healthy.
Evidence to Attach
Screenshot of Vulnerability Assessment â†’ Scan results
Screenshot showing No failed findings
Terraform snippet (if used)
6ï¸âƒ£ Quick Summary Table (For Excel)
Item
Value
Resource
Azure SQL Database
Issue
Vulnerability findings present
Fix
Enable VA + remediate findings
Method
Defender for Cloud
Status
Healthy
Scan
Completed
If you want next, I can:
âœ” Write 1-line justification per SQL DB
âœ” Explain baseline vs exception
âœ” Help prioritize High vs Medium findings
Just tell me ğŸ‘



https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/linux_function_app#auth_settings_v2

Recommended â€“ Easy Auth)
Step-by-step
Azure Portal â†’ Function App
Go to Settings â†’ Authentication
Click Add identity provider
Choose Microsoft Entra ID
Configure:
Tenant: Current tenant
App registration: Create new or Existing
Under Action to take when request is not authenticated:
âœ… Require authentication
Save
ğŸ“˜ Microsoft Learn
https://learn.microsoft.com/azure/app-service/configure-authentication-provider-aad
ğŸ”¹ Block Anonymous Requests (Important)
After enabling authentication:
Ensure Anonymous access = Disabled
Unauthenticated calls must return 401
ğŸ“˜
https://learn.microsoft.com/azure/app-service/overview-authentication-authorization
ğŸ”¹ Verify (Mandatory for Defender)
Test your endpoint:
Copy code
Bash
curl https://<functionapp>.azurewebsites.net/api/<function>
Expected:
âŒ Without token â†’ 401 Unauthorized
âœ… With token â†’ 200 OK
Defender will re-check within 24 hours.
3ï¸âƒ£ Terraform â€“ Precise Configuration
ğŸ”¹ Enable Entra Authentication on Function App
Copy code
Hcl
resource "azurerm_linux_function_app" "func" {
  name                = "sample-func"
  resource_group_name = azurerm_resource_group.rg.name
  location            = azurerm_resource_group.rg.location
  service_plan_id     = azurerm_service_plan.plan.id

  site_config {}

  auth_settings_v2 {
    auth_enabled = true

    login {
      token_store_enabled = true
    }

    active_directory_v2 {
      client_id            = azurerm_ad_application.app.application_id
      tenant_auth_endpoint = "https://login.microsoftonline.com/${var.tenant_id}/v2.0"
    }

    default_provider = "azureactivedirectory"
  }
}
